# 🎓 教学指南 - 豆瓣电影搜索系统

## 课程准备清单

### 提前准备（至少提前1天）

- [ ] 测试所有代码，确保能正常运行
- [ ] 准备好 Python 环境（建议 Python 3.8+）
- [ ] 测试豆瓣API是否可用
- [ ] 准备好备用方案（如果API不可用）
- [ ] 准备演示用的PPT（可选）
- [ ] 打印学生练习题

### 上课前30分钟

- [ ] 测试教室网络和投影设备
- [ ] 在自己电脑上运行一遍所有示例
- [ ] 准备好GitHub仓库链接（供学生下载）
- [ ] 打开所有需要的网页和工具

---

## 第一节课详细教案（90分钟）

### 📌 课程目标
让学生理解Web API的概念，掌握FastAPI基础，能够调用第三方API。

### 🕐 时间安排

#### 1. 开场和环境准备（10分钟）

**教师活动：**
- 自我介绍
- 课程内容概览
- 学习目标说明
- 演示最终项目效果

**学生活动：**
- 克隆/下载项目代码
- 安装依赖包：`pip install -r requirements.txt`
- 验证环境是否正常

**话术建议：**
```
"今天我们要做一个非常酷的项目 - 豆瓣电影搜索系统。
大家平时用豆瓣吗？我们今天就要学习如何调用豆瓣的API，
做一个属于自己的电影搜索网站。

首先，让我们看看最终效果是什么样的...
（演示完整项目）

看起来还不错对吧？别担心，我们会一步一步实现它。"
```

**常见问题：**
- Python版本太低：建议升级到3.8+
- pip安装失败：切换国内镜像源
- 网络问题：提供离线安装包

---

#### 2. FastAPI入门（20分钟）

**教学文件：** `lesson1/step1_hello_fastapi.py`

**讲解要点：**

1. **什么是Web API？**（5分钟）
   ```
   - Web API就是网站提供给程序调用的接口
   - 例如：你在APP里看到的天气、新闻，都是调用API获取的
   - API返回的通常是JSON格式的数据
   ```

2. **FastAPI的优势**（3分钟）
   ```
   - 比Django轻量，比Flask现代
   - 自动生成API文档（重点演示 /docs）
   - 支持类型提示，减少bug
   - 异步支持，性能好
   ```

3. **核心概念讲解**（12分钟）
   - 路由装饰器：`@app.get()`
   - 路径参数：`/hello/{name}`
   - 查询参数：`?name=value`
   - 数据模型：Pydantic

**演示步骤：**
```bash
# 1. 运行第一个示例
cd lesson1
uvicorn step1_hello_fastapi:app --reload

# 2. 访问根路径
# 浏览器打开: http://127.0.0.1:8000

# 3. 访问API文档（重点！）
# http://127.0.0.1:8000/docs

# 4. 测试不同的端点
# /hello/张三
# /greet?name=李四&age=20
```

**互动环节：**
- 让学生修改返回的消息
- 让学生添加一个新的端点
- 在 /docs 页面测试 POST 请求

**知识检查：**
```
Q: GET和POST有什么区别？
Q: 路径参数和查询参数的区别是什么？
Q: 为什么要使用数据模型？
```

---

#### 3. 构建电影API（20分钟）

**教学文件：** `lesson1/step2_basic_api.py`

**讲解要点：**

1. **RESTful API设计**（5分钟）
   ```
   GET    /movies        - 获取列表
   GET    /movies/{id}   - 获取单个
   POST   /movies        - 创建
   PUT    /movies/{id}   - 更新
   DELETE /movies/{id}   - 删除
   ```

2. **数据模型设计**（5分钟）
   - Movie 模型的字段
   - 数据验证（Field）
   - 创建时和返回时的模型区别

3. **CRUD操作实现**（10分钟）
   - 查询（分页、筛选）
   - 创建
   - 更新
   - 删除

**演示步骤：**
```bash
# 1. 运行示例
uvicorn step2_basic_api:app --reload

# 2. 在 /docs 页面测试各个端点
# - 获取电影列表
# - 添加一部新电影
# - 搜索电影
# - 查看统计信息
```

**实践任务：**
```
让学生完成以下任务（10分钟）：
1. 添加一部你喜欢的电影
2. 搜索包含"肖申克"的电影
3. 实现按评分筛选的功能（参考练习题）
```

**讨论问题：**
```
Q: 这个"数据库"有什么问题？
A: 重启后数据丢失

Q: 如何解决？
A: 使用真实数据库（SQLite、PostgreSQL等）
   或者序列化到文件
```

---

#### 4. 集成豆瓣API（30分钟）

**教学文件：** `lesson1/step3_douban_api.py`

**讲解要点：**

1. **异步编程简介**（5分钟）
   ```python
   # 同步 vs 异步
   def sync_function():
       time.sleep(1)  # 阻塞
       
   async def async_function():
       await asyncio.sleep(1)  # 不阻塞
   ```

2. **httpx 异步HTTP客户端**（5分钟）
   ```python
   async with httpx.AsyncClient() as client:
       response = await client.get(url)
       data = response.json()
   ```

3. **API调用和数据解析**（10分钟）
   - 构建请求URL
   - 处理响应数据
   - 错误处理（超时、HTTP错误）
   - 数据转换

4. **实际测试**（10分钟）

**演示步骤：**
```bash
# 1. 运行豆瓣API服务
uvicorn step3_douban_api:app --reload

# 2. 测试搜索功能
# http://127.0.0.1:8000/search?q=肖申克

# 3. 查看Top250
# http://127.0.0.1:8000/top250

# 4. 获取电影详情
# 从搜索结果中找到电影ID，然后访问
# http://127.0.0.1:8000/movie/1292052
```

**实践任务：**
```
让学生完成（10分钟）：
1. 搜索自己喜欢的电影
2. 查看某部电影的详细信息
3. 尝试不同的筛选条件
```

**可能的问题：**
- API请求失败：检查网络、更换API源
- 超时：调整timeout参数
- 编码问题：确保使用UTF-8

---

#### 5. 课堂练习和答疑（10分钟）

**练习内容：** 参考 `lesson1/exercises.md`

**建议：**
- 选择1-2个简单的练习让学生当场完成
- 巡视学生完成情况
- 解答疑问
- 鼓励学生互相讨论

**总结要点：**
```
今天我们学习了：
✅ FastAPI框架基础
✅ RESTful API设计
✅ 数据模型和验证
✅ 异步HTTP请求
✅ 第三方API集成

下节课我们将：
🎯 添加Web界面
🎯 实现收藏功能
🎯 数据可视化
🎯 项目部署
```

---

## 第二节课详细教案（90分钟）

### 📌 课程目标
完成完整的Web应用，包括前端界面、用户交互、数据持久化。

### 🕐 时间安排

#### 1. 回顾和预热（5分钟）

**教师活动：**
- 快速回顾第一节课内容
- 展示今天要完成的目标
- 回答上节课遗留问题

**话术：**
```
"上节课我们已经完成了后端API，可以搜索电影、获取详情。
但是现在的界面是什么样的？（打开 /docs）
对，只有API文档页面，不够美观。

今天我们要做什么？
给它加上漂亮的前端界面，让它看起来像一个真正的网站！"
```

---

#### 2. 前端基础讲解（25分钟）

**教学文件：** `lesson2/main.py`, `templates/index.html`

**讲解要点：**

1. **项目结构**（5分钟）
   ```
   lesson2/
   ├── main.py          # 后端
   ├── templates/       # HTML模板
   │   └── index.html
   └── static/          # CSS、JS
       ├── style.css
       └── script.js
   ```

2. **模板引擎**（5分钟）
   ```python
   # Jinja2模板
   templates = Jinja2Templates(directory="templates")
   
   @app.get("/")
   async def index(request: Request):
       return templates.TemplateResponse(
           "index.html",
           {"request": request, "title": "电影搜索"}
       )
   ```

3. **HTML结构**（10分钟）
   - 导航栏
   - 标签页
   - 电影卡片
   - 模态框

4. **CSS样式**（5分钟）
   - 响应式布局
   - 卡片设计
   - 动画效果

**演示：**
```bash
# 运行完整应用
cd lesson2
uvicorn main:app --reload

# 访问 http://127.0.0.1:8000
# 展示各个功能模块
```

---

#### 3. JavaScript交互（30分钟）

**教学文件：** `static/script.js`

**讲解要点：**

1. **前后端通信**（10分钟）
   ```javascript
   // Fetch API
   const response = await fetch('/api/search?q=肖申克');
   const data = await response.json();
   
   // POST请求
   await fetch('/api/favorites/123', {
       method: 'POST'
   });
   ```

2. **动态渲染**（10分钟）
   ```javascript
   // 创建电影卡片
   function createMovieCard(movie) {
       const card = document.createElement('div');
       card.innerHTML = `...`;
       return card;
   }
   
   // 添加到页面
   resultsDiv.appendChild(card);
   ```

3. **事件处理**（10分钟）
   - 搜索按钮点击
   - 标签页切换
   - 收藏功能
   - 模态框显示

**实践演示：**
```
1. 搜索电影
   - 输入关键词 → 发送请求 → 显示结果

2. 查看详情
   - 点击卡片 → 获取详情 → 弹出模态框

3. 收藏功能
   - 点击收藏 → POST请求 → 更新状态

4. 统计页面
   - 切换到统计 → 获取数据 → 渲染图表
```

---

#### 4. 功能完善（20分钟）

**重点功能演示：**

1. **收藏功能**（8分钟）
   ```python
   # 后端
   @app.post("/api/favorites/{movie_id}")
   async def add_favorite(movie_id: str):
       # 保存到内存/数据库
       
   # 前端
   async function addToFavorites(movieId) {
       const response = await fetch(`/api/favorites/${movieId}`, {
           method: 'POST'
       });
   }
   ```

2. **搜索历史**（6分钟）
   - 记录每次搜索
   - 显示最近搜索
   - 快速重复搜索

3. **统计功能**（6分钟）
   - 收藏数量
   - 平均评分
   - 类型分布
   - 搜索次数

**实践任务：**
```
让学生尝试（10分钟）：
1. 搜索并收藏3部电影
2. 查看统计信息
3. 尝试不同城市的热映电影
```

---

#### 5. 扩展和部署（10分钟）

**讲解内容：**

1. **数据持久化方案**（3分钟）
   ```
   当前：内存存储（重启丢失）
   改进：
   - JSON文件存储
   - SQLite数据库
   - PostgreSQL/MySQL
   ```

2. **部署方式**（4分钟）
   ```
   本地开发：
   uvicorn main:app --reload
   
   生产环境：
   - 使用 gunicorn + uvicorn
   - Docker容器化
   - 云平台部署（Render、Railway、Heroku）
   ```

3. **可能的扩展方向**（3分钟）
   ```
   - 用户登录系统
   - 评论功能
   - 社交分享
   - 推荐算法
   - 电影日历
   - 观影打卡
   ```

---

#### 6. 总结和答疑（10分钟）

**课程总结：**
```
两节课我们完成了什么？
✅ 学会了FastAPI框架
✅ 理解了RESTful API设计
✅ 掌握了异步编程基础
✅ 学会调用第三方API
✅ 完成了前后端整合
✅ 实现了完整的Web应用

这些技能可以用在哪里？
💡 开发自己的API服务
💡 数据采集和处理
💡 构建Web应用
💡 毕业设计项目
💡 实习和工作中
```

**作业布置：**
```
基础作业：
1. 完善收藏功能（添加备注）
2. 实现按类型筛选
3. 优化界面样式

进阶作业：
1. 添加SQLite数据库
2. 实现用户登录
3. 部署到云平台

提交方式：
- GitHub仓库链接
- 或部署后的网站链接
```

**答疑环节：**
- 解答学生疑问
- 提供学习资源
- 交换联系方式（后续答疑）

---

## 教学技巧

### 💡 课堂互动建议

1. **提问技巧**
   - 多用开放式问题："为什么我们要这样设计？"
   - 鼓励学生思考："如果...会怎样？"
   - 及时肯定学生的回答

2. **演示技巧**
   - 边写代码边讲解（live coding）
   - 故意犯一些小错误，展示调试过程
   - 使用浏览器开发者工具展示网络请求

3. **节奏控制**
   - 每20分钟换一个话题或活动
   - 适时提问，保持学生注意力
   - 留出实践时间，不要一直讲

### ⚠️ 常见问题处理

**问题1：学生环境配置失败**
- 准备一个云端开发环境（如Replit、Gitpod）
- 或者准备好虚拟机镜像

**问题2：豆瓣API不可用**
- 准备备用API（如TMDB、OMDB）
- 或者提前缓存一些数据

**问题3：学生水平参差不齐**
- 快的学生：提供进阶任务
- 慢的学生：一对一辅导或安排同学互助

**问题4：时间不够用**
- 优先完成核心功能
- 次要功能布置为作业
- 录制教学视频供课后观看

### 📚 补充资源

**推荐学习资料：**
- FastAPI官方文档（中文版）
- Python异步编程教程
- Web开发最佳实践

**示例项目：**
- GitHub搜索器
- 天气查询系统
- 新闻聚合网站

---

## 课后跟进

1. **建立学习群**
   - 微信群或QQ群
   - 分享资料和答疑

2. **代码仓库**
   - 上传完整代码到GitHub
   - 提供详细的README

3. **作业批改**
   - Code Review
   - 给出具体改进建议

4. **后续指导**
   - 推荐进阶项目
   - 职业发展建议

---

**祝教学顺利！有任何问题欢迎随时联系！** 🎓✨
