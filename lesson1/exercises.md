# ç¬¬ä¸€èŠ‚è¯¾ - è¯¾å ‚ç»ƒä¹ 

## ğŸ“ ç»ƒä¹ ä¸€ï¼šFastAPIåŸºç¡€ï¼ˆ15åˆ†é’Ÿï¼‰

### é¢˜ç›®
åŸºäº `step1_hello_fastapi.py`ï¼Œå®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š

1. **ä¸ªäººä¿¡æ¯API**
   - åˆ›å»º `/about` ç«¯ç‚¹
   - è¿”å›ä½ çš„å§“åã€ä¸“ä¸šã€çˆ±å¥½ç­‰ä¿¡æ¯
   - ä½¿ç”¨å­—å…¸æ ¼å¼è¿”å›

2. **è®¡ç®—å™¨API**
   - åˆ›å»º `/calculate` ç«¯ç‚¹
   - æ¥æ”¶ä¸¤ä¸ªæ•°å­—å‚æ•°ï¼š`a` å’Œ `b`
   - æ¥æ”¶ä¸€ä¸ªæ“ä½œç¬¦å‚æ•°ï¼š`op`ï¼ˆå¯é€‰å€¼ï¼šadd, subtract, multiply, divideï¼‰
   - è¿”å›è®¡ç®—ç»“æœ

3. **å­¦ç”ŸæŸ¥è¯¢API**
   - åˆ›å»ºä¸€ä¸ª `Student` æ•°æ®æ¨¡å‹ï¼ˆåŒ…å«ï¼šid, name, age, majorï¼‰
   - åˆ›å»º `/students/{student_id}` ç«¯ç‚¹
   - è¿”å›å¯¹åº”å­¦ç”Ÿçš„ä¿¡æ¯ï¼ˆå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰

### æç¤º
```python
# è®¡ç®—å™¨ç¤ºä¾‹
@app.get("/calculate")
async def calculate(
    a: float,
    b: float,
    op: str = Query(..., regex="^(add|subtract|multiply|divide)$")
):
    # ä½ çš„ä»£ç 
    pass
```

---

## ğŸ“ ç»ƒä¹ äºŒï¼šæ•°æ®æ¨¡å‹å’ŒCRUDï¼ˆ20åˆ†é’Ÿï¼‰

### é¢˜ç›®
åŸºäº `step2_basic_api.py`ï¼Œæ‰©å±•ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **é«˜çº§æœç´¢**
   - åˆ›å»º `/movies/advanced-search` ç«¯ç‚¹
   - æ”¯æŒåŒæ—¶æŒ‰å¹´ä»½èŒƒå›´å’Œè¯„åˆ†èŒƒå›´ç­›é€‰
   - å‚æ•°ï¼š`year_from`, `year_to`, `min_rating`, `max_rating`

2. **å¯¼æ¼”ç»Ÿè®¡**
   - åˆ›å»º `/directors` ç«¯ç‚¹
   - è¿”å›æ‰€æœ‰å¯¼æ¼”åŠå…¶ä½œå“æ•°é‡
   - æŒ‰ä½œå“æ•°é‡é™åºæ’åˆ—

3. **æ‰¹é‡æ“ä½œ**
   - åˆ›å»º `/movies/batch` ç«¯ç‚¹ï¼ˆPOSTï¼‰
   - æ”¯æŒä¸€æ¬¡æ€§æ·»åŠ å¤šéƒ¨ç”µå½±
   - è¿”å›æ·»åŠ æˆåŠŸçš„ç”µå½±åˆ—è¡¨

### æç¤º
```python
# é«˜çº§æœç´¢ç¤ºä¾‹
@app.get("/movies/advanced-search")
async def advanced_search(
    year_from: Optional[int] = None,
    year_to: Optional[int] = None,
    min_rating: Optional[float] = None,
    max_rating: Optional[float] = None
):
    results = movies_db
    
    if year_from:
        results = [m for m in results if m.year >= year_from]
    
    # ç»§ç»­ç­›é€‰...
    
    return results
```

---

## ğŸ“ ç»ƒä¹ ä¸‰ï¼šè±†ç“£APIé›†æˆï¼ˆ20åˆ†é’Ÿï¼‰

### é¢˜ç›®
åŸºäº `step3_douban_api.py`ï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **æŒ‰å¯¼æ¼”æœç´¢**
   - åˆ›å»º `/search/director` ç«¯ç‚¹
   - è¾“å…¥å¯¼æ¼”åå­—ï¼Œè¿”å›è¯¥å¯¼æ¼”çš„æ‰€æœ‰ç”µå½±
   - æŒ‰è¯„åˆ†é™åºæ’åˆ—

2. **ç”µå½±å¯¹æ¯”**
   - åˆ›å»º `/compare` ç«¯ç‚¹
   - æ¥æ”¶ä¸¤ä¸ªç”µå½±ID
   - è¿”å›ä¸¤éƒ¨ç”µå½±çš„å¯¹æ¯”ä¿¡æ¯ï¼ˆè¯„åˆ†ã€å¹´ä»½ã€ç±»å‹ç­‰ï¼‰

3. **ä¸ªæ€§åŒ–æ¨è**
   - åˆ›å»º `/recommend/similar` ç«¯ç‚¹
   - è¾“å…¥ä¸€ä¸ªç”µå½±ID
   - è¿”å›ç›¸ä¼¼ç±»å‹ä¸”è¯„åˆ†æ¥è¿‘çš„ç”µå½±
   - æç¤ºï¼šå¯ä»¥åŸºäºç±»å‹å’Œè¯„åˆ†è¿›è¡ŒåŒ¹é…

### æç¤º
```python
# ç”µå½±å¯¹æ¯”ç¤ºä¾‹
@app.get("/compare")
async def compare_movies(
    movie1_id: str = Query(..., description="ç¬¬ä¸€éƒ¨ç”µå½±ID"),
    movie2_id: str = Query(..., description="ç¬¬äºŒéƒ¨ç”µå½±ID")
):
    # è·å–ä¸¤éƒ¨ç”µå½±çš„è¯¦ç»†ä¿¡æ¯
    movie1 = await fetch_from_douban(f"v2/movie/subject/{movie1_id}")
    movie2 = await fetch_from_douban(f"v2/movie/subject/{movie2_id}")
    
    # æ„å»ºå¯¹æ¯”ç»“æœ
    comparison = {
        "movie1": parse_movie_data(movie1),
        "movie2": parse_movie_data(movie2),
        "comparison": {
            "rating_diff": abs(movie1_rating - movie2_rating),
            # æ›´å¤šå¯¹æ¯”...
        }
    }
    
    return comparison
```

---

## ğŸ¯ æŒ‘æˆ˜é¢˜ï¼ˆè¯¾åä½œä¸šï¼‰

### éš¾åº¦ï¼šâ­â­â­

1. **ç¼“å­˜æœºåˆ¶**
   - å®ç°ä¸€ä¸ªç®€å•çš„å†…å­˜ç¼“å­˜
   - ç¼“å­˜è±†ç“£APIçš„æœç´¢ç»“æœ
   - 5åˆ†é’Ÿå†…ç›¸åŒçš„æœç´¢ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ

```python
from datetime import datetime, timedelta

cache = {}

def get_cache(key):
    if key in cache:
        data, timestamp = cache[key]
        if datetime.now() - timestamp < timedelta(minutes=5):
            return data
    return None

def set_cache(key, data):
    cache[key] = (data, datetime.now())
```

2. **é”™è¯¯é‡è¯•**
   - å½“è±†ç“£APIè¯·æ±‚å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨é‡è¯•3æ¬¡
   - ä½¿ç”¨æŒ‡æ•°é€€é¿ç­–ç•¥ï¼ˆç¬¬1æ¬¡ç­‰1ç§’ï¼Œç¬¬2æ¬¡ç­‰2ç§’ï¼Œç¬¬3æ¬¡ç­‰4ç§’ï¼‰

3. **APIé™æµ**
   - å®ç°ä¸€ä¸ªç®€å•çš„é™æµå™¨
   - æ¯ä¸ªIPæ¯åˆ†é’Ÿæœ€å¤šè¯·æ±‚10æ¬¡
   - è¶…è¿‡é™åˆ¶è¿”å›429çŠ¶æ€ç 

---

## âœ… è‡ªæˆ‘æ£€æŸ¥æ¸…å•

å®Œæˆç»ƒä¹ åï¼Œç¡®ä¿ä½ èƒ½å¤Ÿï¼š

- [ ] åˆ›å»ºåŸºæœ¬çš„GET/POSTç«¯ç‚¹
- [ ] ä½¿ç”¨è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°
- [ ] å®šä¹‰å’Œä½¿ç”¨Pydanticæ•°æ®æ¨¡å‹
- [ ] å®ç°CRUDæ“ä½œ
- [ ] è°ƒç”¨ç¬¬ä¸‰æ–¹API
- [ ] å¤„ç†å¼‚æ­¥HTTPè¯·æ±‚
- [ ] è¿›è¡ŒåŸºæœ¬çš„é”™è¯¯å¤„ç†
- [ ] ä½¿ç”¨FastAPIçš„è‡ªåŠ¨æ–‡æ¡£

---

## ğŸ’¡ æç¤ºå’ŒæŠ€å·§

1. **è°ƒè¯•æŠ€å·§**
   - ä½¿ç”¨ `print()` æˆ– `logging` è¾“å‡ºä¸­é—´ç»“æœ
   - åœ¨ `/docs` é¡µé¢æµ‹è¯•API
   - ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

2. **å¸¸è§é”™è¯¯**
   - å¿˜è®° `async`/`await` å…³é”®å­—
   - å‚æ•°ç±»å‹ä¸åŒ¹é…
   - è·¯å¾„å†²çªï¼ˆå¦‚ `/movies/search` å’Œ `/movies/{movie_id}`ï¼‰

3. **æœ€ä½³å®è·µ**
   - ç»™æ¯ä¸ªç«¯ç‚¹æ·»åŠ æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å
   - åˆç†è®¾ç½®å‚æ•°çš„é»˜è®¤å€¼å’ŒéªŒè¯è§„åˆ™

---

**ç¥ä½ ç»ƒä¹ é¡ºåˆ©ï¼æœ‰é—®é¢˜éšæ—¶ä¸¾æ‰‹æé—®ï¼ğŸ‰**
